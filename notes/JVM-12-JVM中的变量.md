[[JVM]]

深入地了解变量有助于我们理解强引用、弱引用和虚引用之间的区别以及对对象回收的影响，帮助我们更加灵活地使用Java内存模型，避免一些特殊情况下的内存泄漏和性能问题。而学会从不同的维度去认识变量，也是我们写出高性能的程序的基础。

## JVM中的变量

### JVM中的变量以及变量中的类型

静态类型和实际类型:

```java
Food food = new Fruit();
```

> 在food背后，有一个与它对应的klass对象，它记录了food的类型信息，就像是有一个标签写着food的品类和特点。每个klass对象维护着一个虚函数表，记录了类中所有的虚函数以及对应的指针。当food调用一个方法时，JVM根据它的实际类型找到它的klass对象，然后在虚函数表中寻找正确的函数指针，使得food能够调用正确的方法。这种实现方式让我们具备了多态性，让它的行为可以根据实际情况进行适应。

### 生存空间

变量的创建位置有三个：栈上、堆中和方法区中。

- 栈上的变量是局部变量，包括方法中定义的变量和代码块中定义的变量。

- 堆中的变量是通过new关键字创建的对象和数组。
- 方法区中的变量主要是静态变量。

### 回收

```java
Food food = new Fruit();
```

#### 强引用（Strong Reference）

强引用是最常见的引用类型，它的作用是让对象存活期与引用的存活期保持一致。

#### 软引用（Soft Reference）

软引用是一种比较灵活的引用类型，它的作用是描述非必要对象。

OOM之前，垃圾回收器会将软引用对象列为可回收的对象范围，为程序提供更多可用空间。

#### 弱引用（Weak Reference）

相对于强引用的一种引用类型，强度较弱。

如果一个对象只存在弱引用，垃圾回收器在下一次进行垃圾回收时就会回收它。

#### 虚引用（Phantom Reference）

定义虚引用后，无法通过虚引用获取所指向的对象，并且虚引用对象无法直接使用。

虚引用主要用于在对象被回收时收到通知，用于执行一些清理工作或记录相关日志。
